<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MannKiBaat_2.0: Generative AI for Youth Mental Wellness</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="static/css/dashboard.css">
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Fixed Navbar -->
    <nav class="navbar fixed-top navbar-expand-lg">
        <div class="container-fluid">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="bi bi-list text-white fs-5"></i>
                <span class="app-title">MannKiBaat_2.0</span>
            </button>
            <div class="ms-auto d-flex align-items-center">
                <button class="theme-toggle me-3" id="themeToggle">
                    <i class="bi bi-sun fs-5"></i>
                </button>
                <div class="dropdown">
                    <button class="btn dropdown-toggle" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle"></i>
                        <span class="ms-2">Profile</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                        <li><a class="dropdown-item" href="#" data-view="profile">View Profile</a></li>
                        <li><a class="dropdown-item" href="#" data-view="favorites">Favorite Affirmations</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="nav-items mt-4">
            <div class="nav-item active" data-view="home">
                <i class="bi bi-house"></i>
                <span class="ms-2">Home</span>
            </div>
            <div class="nav-item" data-view="chatbot">
                <i class="bi bi-chat"></i>
                <span class="ms-2">Chat Bot</span>
            </div>
            <div class="nav-item" data-view="crisis">
                <i class="bi bi-exclamation-triangle"></i>
                <span class="ms-2">Crisis Detection</span>
            </div>
            <div class="nav-item" data-view="community">
                <i class="bi bi-people"></i>
                <span class="ms-2">Community</span>
            </div>
            <div class="nav-item" data-view="activities">
                <i class="bi bi-controller"></i>
                <span class="ms-2">Activities</span>
            </div>
            <div class="nav-item" data-view="affirmations">
                <i class="bi bi-stars"></i>
                <span class="ms-2">Affirmations</span>
            </div>
            <div class="nav-item" data-view="lifestyle">
                <i class="bi bi-heart"></i>
                <span class="ms-2">Lifestyle</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Home View -->
        <div id="homeView">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-bg-animation">
                    <div class="hero-bg-circle circle-1"></div>
                    <div class="hero-bg-circle circle-2"></div>
                </div>
                
                <div class="container position-relative z-10">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 text-center">
                            <h1 class="display-3 fw-bold mb-4 text-gradient">MannKiBaat_2.0 - AI for Mental Wellness</h1>
                            <p class="lead mb-5">A safe space for chat, community, and personal growth.</p>
                            <button class="btn btn-gradient btn-lg px-5 py-3 fw-semibold animate-pulse-glow" data-view="chatbot">
                                Start Chatting <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="py-5">
                <div class="container py-5">
                    <h2 class="text-center mb-5 display-5 fw-bold">Our Features</h2>
                    
                    <div class="row g-4">
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="chatbot">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-chat-text text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">AI Chat Bot</h3>
                                <p class="text-center">Friendly conversations, storytelling, and creative poetry to support your mental wellness journey.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="crisis">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-exclamation-triangle text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Crisis Support</h3>
                                <p class="text-center">Immediate access to crisis resources and emergency support when you need it most.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-bs-toggle="modal" data-bs-target="#communityModal">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-people text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Community Hub</h3>
                                <p class="text-center">Connect with peers, share stories, and join supportive group activities.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-bs-toggle="modal" data-bs-target="#activitiesModal">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-controller text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Wellness Activities</h3>
                                <p class="text-center">Personalized and community activities designed to boost your mental health.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="affirmations">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-stars text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Daily Affirmations</h3>
                                <p class="text-center">Uplifting messages delivered through text, voice, and video formats.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="lifestyle">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-heart text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Lifestyle Tracking</h3>
                                <p class="text-center">Monitor your sleep, diet, and exercise with personalized wellness suggestions.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            {% include 'components/footer.html' %}
        </div>

        <!-- Chatbot View -->
        <div id="chatbotView" class="d-none">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary me-3" id="backToHome">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <div class="d-flex align-items-center">
                            <div class="card-icon me-3" style="width: 40px; height: 40px;">
                                <i class="bi bi-chat-text text-white"></i>
                            </div>
                            <div>
                                <h5 class="mb-0">MindfulChat</h5>
                                <small class="text-muted">Your AI wellness companion</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="message bot animate-fade-in">
                        <p class="mb-1">Hello! I'm MindfulChat, your AI companion. How are you feeling today?</p>
                        <small class="opacity-75">10:00 AM</small>
                    </div>
                </div>

                <div class="message-input">
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-secondary btn-sm quick-action" data-action="I need to talk">
                            <i class="bi bi-chat me-1"></i> I need to talk
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-action" data-action="Tell me a story">
                            <i class="bi bi-book me-1"></i> Tell me a story
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-action" data-action="I'm feeling anxious">
                            <i class="bi bi-heart me-1"></i> I'm feeling anxious
                        </button>
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control bg-transparent text-light border-secondary" placeholder="Type your message..." id="messageInput">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="bi bi-mic"></i>
                        </button>
                        <button class="btn btn-gradient" type="button" id="sendMessage">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crisis Detection View -->
        <div id="crisisView" class="d-none crisis-section">
            <div class="border-bottom p-4">
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-secondary me-3" id="backToHomeCrisis">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <div class="d-flex align-items-center">
                        <div class="card-icon me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-exclamation-triangle text-white"></i>
                        </div>
                        <div>
                            <h5 class="mb-0">Crisis Support</h5>
                            <small class="text-muted">Immediate help is available 24/7</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container py-5">
                <!-- Emergency Contacts Section -->
                <div class="card emergency-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-exclamation-triangle-fill me-2"></i> Emergency Resources</h2>
                        <p class="card-text mb-4">If you're in immediate danger or having thoughts of self-harm, reach out now.</p>
                        
                        <div class="row g-4">
                            <div class="col-md-4">
                                <div class="text-center p-4 rounded-lg h-100" style="background-color: rgba(220, 38, 38, 0.1);">
                                    <i class="bi bi-telephone-fill display-4 mb-3" style="color: var(--bs-red);"></i>
                                    <h3 class="h5 mb-3">988 Lifeline</h3>
                                    <p class="mb-3">Suicide & Crisis Lifeline</p>
                                    <button class="btn emergency-btn w-100" data-action="988">
                                        Call Now
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="text-center p-4 rounded-lg h-100" style="background-color: rgba(234, 88, 12, 0.1);">
                                    <i class="bi bi-chat-dots-fill display-4 mb-3" style="color: var(--bs-orange);"></i>
                                    <h3 class="h5 mb-3">Crisis Text Line</h3>
                                    <p class="mb-3">Text HOME to 741741</p>
                                    <button class="btn emergency-btn w-100" data-action="741741">
                                        Text Now
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="text-center p-4 rounded-lg h-100" style="background-color: rgba(220, 38, 38, 0.1);">
                                    <i class="bi bi-ambulance display-4 mb-3" style="color: var(--bs-red);"></i>
                                    <h3 class="h5 mb-3">Emergency Services</h3>
                                    <p class="mb-3">For immediate danger</p>
                                    <button class="btn emergency-btn w-100" data-action="911">
                                        Call 911
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Assessment Section -->
                <div class="card assessment-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-clipboard-heart me-2"></i> Risk Assessment</h2>
                        <p class="card-text mb-4">Help us understand how you're feeling right now.</p>
                        
                        <div class="mb-4">
                            <label class="form-label">Are you having thoughts of hurting yourself?</label>
                            <textarea class="form-control bg-transparent border-secondary" rows="3" placeholder="You can share as much or as little as you're comfortable with..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Do you have a plan to hurt yourself?</label>
                            <textarea class="form-control bg-transparent border-secondary" rows="3" placeholder="This helps us understand the urgency of your situation..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Who can you reach out to for support right now?</label>
                            <textarea class="form-control bg-transparent border-secondary" rows="3" placeholder="Friends, family, counselors, or other support people..."></textarea>
                        </div>
                        
                        <button class="btn btn-gradient w-100">
                            <i class="bi bi-send me-2"></i> Submit Assessment
                        </button>
                    </div>
                </div>

                <!-- Safety Planning Section -->
                <div class="card safety-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-shield-check me-2"></i> Safety Planning</h2>
                        <p class="card-text mb-4">Create your personalized safety plan for difficult moments.</p>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="bi bi-telephone me-2"></i> Support Contacts</h4>
                            <div class="support-contacts">
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Contact name and phone">
                                </div>
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Contact name and phone">
                                </div>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-plus-circle me-1"></i> Add Another Contact
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="bi bi-lightbulb me-2"></i> Coping Strategies</h4>
                            <div class="coping-strategies">
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Coping strategy">
                                </div>
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Coping strategy">
                                </div>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-plus-circle me-1"></i> Add Another Strategy
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="bi bi-geo-alt me-2"></i> Safe Environments</h4>
                            <div class="safe-environments">
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Safe place">
                                </div>
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Safe place">
                                </div>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-plus-circle me-1"></i> Add Another Place
                                </button>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center p-3 rounded-lg mb-3" style="background-color: rgba(0,0,0,0.05);">
                            <div>
                                <h5 class="mb-1">Enable Warning Signs Alerts</h5>
                                <p class="mb-0 small">Get reminders about your personal warning signs</p>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" checked>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center p-3 rounded-lg">
                            <div>
                                <h5 class="mb-1">Professional Help Reminders</h5>
                                <p class="mb-0 small">Regular check-ins about professional support</p>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" checked>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calming Exercises Section -->
                <div class="card calming-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-wind me-2"></i> Calming Exercises</h2>
                        <p class="card-text mb-4">Quick techniques to help you feel more grounded and calm.</p>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h4 class="mb-3"><i class="bi bi-wind me-2"></i> Breathing Exercise</h4>
                                    <div class="breathing-circle" id="breathingCircle">
                                        <div class="text-center">
                                            <div class="display-3 fw-bold" id="breathCount">4</div>
                                            <div class="text-uppercase fw-bold" id="breathPhase">Inhale</div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-4">
                                        <button class="btn btn-gradient" id="startBreathing">
                                            <i class="bi bi-play-circle me-2"></i> Start Exercise
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h4 class="mb-3"><i class="bi bi-eye me-2"></i> Grounding Technique</h4>
                                    <p>Follow the 5-4-3-2-1 method to center yourself:</p>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item bg-transparent border-secondary">5 things you can see</li>
                                        <li class="list-group-item bg-transparent border-secondary">4 things you can touch</li>
                                        <li class="list-group-item bg-transparent border-secondary">3 things you can hear</li>
                                        <li class="list-group-item bg-transparent border-secondary">2 things you can smell</li>
                                        <li class="list-group-item bg-transparent border-secondary">1 thing you can taste</li>
                                    </ul>
                                    <button class="btn btn-outline-secondary mt-3 w-100">
                                        <i class="bi bi-clock me-2"></i> Start 5-Minute Exercise
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resources Section -->
                <div class="card resources-card border-0 shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-book me-2"></i> Additional Resources</h2>
                        <p class="card-text mb-4">Links to additional mental health support services and information.</p>
                        
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> NAMI</h5>
                                    <p class="small">National Alliance on Mental Illness - Support groups and educational resources</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> Mental Health America</h5>
                                    <p class="small">Screening tools and local resources for mental health support</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> Crisis Text Line</h5>
                                    <p class="small">24/7 text-based crisis support for any kind of crisis</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> SAMHSA</h5>
                                    <p class="small">Substance Abuse and Mental Health Services Administration - Treatment locator</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profileView" class="d-none profile-section">
            <div class="container py-5">
                <div class="profile-card">
                    <h2>Welcome, {{ user.firstName }}!</h2>
                    <h3>Lifestyle Details:</h3>
                    {% if lifestyle %}
                    <p>Diet: {{ lifestyle.diet }}</p>
                    <p>Activity: {{ lifestyle.physicalActivity }}</p>
                    <p>Sleep Hours: {{ lifestyle.sleepHrs }}</p>
                    {% else %}
                    <p>No lifestyle data available.</p>
                    {% endif %}
                    <h3>Selected Categories:</h3>
                    <ul>
                        {% for c in categories %}
                        <li><b>{{ c.category }}:</b> {{ c.subcategory }} <br> {{ c.description }}</li>
                        {% endfor %}
                    </ul>
                    <div class="mt-4">
                        <button class="btn btn-gradient" data-view="home">Back to Home</button>
                        <a href="/logout" class="btn btn-outline-secondary ms-2">Logout</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Affirmations View -->
        <div id="affirmationsView" class="d-none">
            <div class="container py-5">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        
                        <div class="affirmation-card">
                            <div class="affirmation-image" id="affirmationImage">
                                <!-- Previous button on left of image -->
                                <button class="side-btn prev-btn" id="prevAffirmationSide" title="Previous">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <!-- Affirmation text overlay -->
                                <div class="affirmation-overlay">
                                    <p class="affirmation-text" id="affirmationText"></p>
                                </div>
                                <!-- Like, refresh, save buttons separately -->
                                <div class="affirmation-action action-left">
                                    <button class="btn-affirmation" id="likeAffirmation" title="Like">
                                        <i class="bi bi-heart"></i>
                                    </button>
                                </div>
                                <div class="affirmation-action action-center">
                                    <button class="btn-affirmation" id="refreshAffirmation" title="Refresh">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </button>
                                </div>
                                <div class="affirmation-action action-right">
                                    <button class="btn-affirmation" id="saveAffirmation" title="Save">
                                        <i class="bi bi-bookmark"></i>
                                    </button>
                                </div>
                                <!-- Next button on right of image -->
                                <button class="side-btn next-btn" id="nextAffirmationSide" title="Next">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


 <!-- Favorites View -->
        <div id="favoritesView" class="d-none">
            <div class="container py-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="text-gradient">Your Favorite Affirmations</h2>
                    <button class="btn btn-outline-secondary" data-view="affirmations">
                        <i class="bi bi-arrow-left"></i> Back to Affirmations
                    </button>
                </div>

                <div id="favoritesContainer" class="favorites-grid">
                    <div class="text-center py-5" id="emptyFavorites">
                        <i class="bi bi-bookmark-plus display-1 text-muted"></i>
                        <p class="mt-3">You haven't saved any affirmations yet.</p>
                        <button class="btn btn-gradient mt-2" data-view="affirmations">
                            Browse Affirmations
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lifestyle View -->
<div id="lifestyleView" class="d-none">
  <div class="container py-5 text-center">

    <h2 class="mb-4">Lifestyle Suggestions</h2>

    <!-- Activities list -->
    <div id="activitiesContainer" class="row g-3 justify-content-center"></div>

    <!-- Surprise Me Button -->
    <button id="surpriseMeBtn" class="btn btn-success mt-4">Surprise Me!</button>

    <!-- Streak indicator -->
    <div class="mt-4">
      <strong>Your streak:</strong> <span id="streakCounter">0</span>
    </div>

  </div>
</div>


    <!-- Modals -->
    <div class="modal fade" id="communityModal" tabindex="-1" aria-labelledby="communityModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="communityModalLabel">Community Hub</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Join our supportive community to connect with peers and share your experiences.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

<div class="modal fade" id="activitiesModal" tabindex="-1" aria-labelledby="activitiesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="activitiesModalLabel">Wellness Activities</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <button id="surpriseBtn" class="btn btn-primary">Surprise Me</button>
            <button id="refreshBtn" class="btn btn-outline-secondary">Show Again</button>
          </div>
          <div>
            <small>Streak:</small>
            <span id="streakBadge" class="badge bg-success">0</span>
          </div>
        </div>

        <ul id="activitiesList" class="list-group">
          <!-- items will be injected here -->
        </ul>
      </div>

      <div class="modal-footer">
        <small class="text-muted me-auto">Complete activities to build your streak — short, mood-lifting tasks.</small>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


    <div class="modal fade" id="lifestyleModal" tabindex="-1" aria-labelledby="lifestyleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="lifestyleModalLabel">Lifestyle Tracking</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Track your sleep, diet, and exercise to improve your overall wellness.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    function showMail(a, b) {
        document.getElementById(a).innerHTML = `<p style="white-space: nowrap; margin:0;">${b}</p>`;
    }

    function hideMail(a) {
        document.getElementById(a).innerHTML = "";
    }

    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const affirmationImages = [
            "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
            "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
            "https://images.unsplash.com/photo-1418065460487-3e41a6c84dc5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
            "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
            "https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80"
        ];

        const todaysAffirmations = []
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const homeView = document.getElementById('homeView');
        const chatbotView = document.getElementById('chatbotView');
        const crisisView = document.getElementById('crisisView');
        const profileView = document.getElementById('profileView');
        const affirmationsView = document.getElementById('affirmationsView');
        const favoritesView = document.getElementById('favoritesView');
        const lifestyleView = document.getElementById('lifestyleView');
        const activitiesView = document.getElementById('activitiesView');
        const backToHome = document.getElementById('backToHome');
        const backToHomeCrisis = document.getElementById('backToHomeCrisis');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessage');
        const messagesContainer = document.getElementById('messagesContainer');
        const navItems = document.querySelectorAll('.nav-item');
        const quickActions = document.querySelectorAll('.quick-action');
        const featureCards = document.querySelectorAll('.feature-card');
        const startBreathingBtn = document.getElementById('startBreathing');
        const breathingCircle = document.getElementById('breathingCircle');
        const breathCount = document.getElementById('breathCount');
        const breathPhase = document.getElementById('breathPhase');
        const themeToggle = document.getElementById('themeToggle');
        const affirmationImage = document.getElementById('affirmationImage');
        const affirmationText = document.getElementById('affirmationText');
        const likeBtn = document.getElementById('likeAffirmation');
        const refreshBtn = document.getElementById('refreshAffirmation');
        const saveBtn = document.getElementById('saveAffirmation');
        const prevBtn = document.getElementById('prevAffirmation');
        const nextBtn = document.getElementById('nextAffirmation');
        const prevBtnSide = document.getElementById('prevAffirmationSide');
        const nextBtnSide = document.getElementById('nextAffirmationSide');
        const favoritesContainer = document.getElementById('favoritesContainer');
        const emptyFavorites = document.getElementById('emptyFavorites');

        // State variables
        let currentView = 'home';
        let messages = [
            {
                id: 1,
                text: "Hello! I'm MindfulChat, your AI companion. How are you feeling today?",
                sender: "bot",
                timestamp: new Date(),
            }
        ];
        let isTyping = false;
        let breathingActive = false;
        let breathingPhaseState = 'inhale';
        let breathingCountState = 4;
        let breathingInterval = null;
        let likedAffirmations = JSON.parse(localStorage.getItem('likedAffirmations')) || [];
        let savedAffirmations = JSON.parse(localStorage.getItem('savedAffirmations')) || [];
        let currentCategory = 'all';
        let currentAffirmation = null;
        let affirmationRequestInProgress = false;

        // Initialize Bootstrap Dropdowns
        function initializeDropdowns() {
            // Find all dropdown toggle elements
            const dropdownTriggers = document.querySelectorAll('[data-bs-toggle="dropdown"]');
            
            dropdownTriggers.forEach(trigger => {
                // Initialize Bootstrap dropdown if available
                if (typeof bootstrap !== 'undefined' && bootstrap.Dropdown) {
                    new bootstrap.Dropdown(trigger);
                }
            });
        }

        // Function to show views dynamically
        function showView(view) {
            [homeView, chatbotView, crisisView, profileView, affirmationsView, favoritesView, lifestyleView]
                .forEach(v => v.classList.add('d-none'));
            view.classList.remove('d-none');
        }

        // CONSOLIDATED navigation handler
        function handleNavigation(targetView) {
            switch (targetView) {
                case 'home': 
                    showView(homeView); 
                    break;
                case 'chatbot': 
                    showView(chatbotView); 
                    break;
                case 'crisis': 
                    showView(crisisView); 
                    break;
                case 'profile': 
                    showView(profileView); 
                    break;
                case 'affirmations':
                    showView(affirmationsView);
                    getRandomAffirmation();
                    break;
                case 'favorites':
                    showView(favoritesView);
                    renderFavorites();
                    break;
                case 'lifestyle':
                    showView(lifestyleView);
                     break;
            }
            
            // Update active nav state
            navItems.forEach(nav => nav.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[data-view="${targetView}"]`);
            if (activeNav) activeNav.classList.add('active');

            // Close any open dropdowns after navigation
            const openDropdowns = document.querySelectorAll('.dropdown-menu.show');
            openDropdowns.forEach(dropdown => {
                dropdown.classList.remove('show');
                const toggle = dropdown.previousElementSibling;
                if (toggle) toggle.setAttribute('aria-expanded', 'false');
            });
        }

        // Navigation event listeners
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                const view = this.dataset.view;
                if (view) {
                    handleNavigation(view);
                }
            });
        });

        // Feature cards navigation
        featureCards.forEach(card => {
            card.addEventListener('click', function() {
                const view = this.dataset.view;
                if (view) {
                    handleNavigation(view);
                }
            });
        });

        // Profile dropdown navigation - Enhanced with proper dropdown handling
        document.querySelectorAll('.dropdown-item[data-view]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const view = this.getAttribute('data-view');
                handleNavigation(view);
            });
        });

        // Handle profile dropdown toggle manually if Bootstrap doesn't work
        const profileDropdownToggle = document.querySelector('.dropdown-toggle[data-bs-toggle="dropdown"]');
        if (profileDropdownToggle) {
            profileDropdownToggle.addEventListener('click', function(e) {
                const dropdownMenu = this.nextElementSibling;
                if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                    const isShown = dropdownMenu.classList.contains('show');
                    
                    // Close all other dropdowns first
                    document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                        if (menu !== dropdownMenu) {
                            menu.classList.remove('show');
                            const toggle = menu.previousElementSibling;
                            if (toggle) toggle.setAttribute('aria-expanded', 'false');
                        }
                    });
                    
                    // Toggle current dropdown
                    if (isShown) {
                        dropdownMenu.classList.remove('show');
                        this.setAttribute('aria-expanded', 'false');
                    } else {
                        dropdownMenu.classList.add('show');
                        this.setAttribute('aria-expanded', 'true');
                    }
                }
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            let clickedInside = false;
            
            dropdownToggles.forEach(toggle => {
                const dropdownMenu = toggle.nextElementSibling;
                if (toggle.contains(e.target) || (dropdownMenu && dropdownMenu.contains(e.target))) {
                    clickedInside = true;
                }
            });
            
            if (!clickedInside) {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                    const toggle = menu.previousElementSibling;
                    if (toggle) toggle.setAttribute('aria-expanded', 'false');
                });
            }
        });

        // Back to home button handlers
        if (backToHome) {
            backToHome.addEventListener('click', function() {
                handleNavigation('home');
            });
        }

        if (backToHomeCrisis) {
            backToHomeCrisis.addEventListener('click', function() {
                handleNavigation('home');
            });
        }

        // PROTECTED affirmation fetch function
            async function getRandomAffirmation() {
            if (affirmationRequestInProgress) {
                console.log('Affirmation request already in progress, skipping...');
                return;
            }
            
            affirmationRequestInProgress = true;
            if (todaysAffirmations.length == 5) {
                    alert("You have reached the maximum of 5 affirmations for today. Please come back tomorrow for more!");
                    return;
                }
            try {

                let url = '/affirmation';
                if (currentCategory && currentCategory !== 'all') {
                    url += `?category=${encodeURIComponent(currentCategory)}`;
                }
                const response = await fetch(url);
                if (!response.ok) throw new Error("Failed to fetch affirmation.");
                const data = await response.json();
                console.log(data.affirmation);
                
                // Create affirmation object with random image
                currentAffirmation = {
                    text: data.affirmation,
                    image: getRandomAffirmationImage() // Use random image from array
                };
                
                todaysAffirmations.push(currentAffirmation);
                    
                
                displayAffirmation(currentAffirmation);
            } catch (error) {
                console.error("Error fetching affirmation:", error);
                // Fallback affirmation also gets random image
                currentAffirmation = {
                    text: "Keep going! You are doing great.",
                    image: getRandomAffirmationImage()
                };
                displayAffirmation(currentAffirmation);
            } finally {
                affirmationRequestInProgress = false;
            }
        }
        function getRandomAffirmationImage() {
            const randomIndex = Math.floor(Math.random() * affirmationImages.length);

            return affirmationImages[randomIndex];
        }

      function displayAffirmation(affirmation) {
            if (affirmationImage && affirmationText) {
                affirmationImage.style.backgroundImage = `url(${affirmation.image})`;
                affirmationText.textContent = affirmation.text;
                updateButtonStates();
            }
        }

        function toggleLike() {
            if (!currentAffirmation) return;
            const index = likedAffirmations.findIndex(a => a.text === currentAffirmation.text);
            if (index === -1) {
                likedAffirmations.push(currentAffirmation);
                likeBtn.classList.add('active');
                likeBtn.innerHTML = '<i class="bi bi-heart-fill"></i>';
            } else {
                likedAffirmations.splice(index, 1);
                likeBtn.classList.remove('active');
                likeBtn.innerHTML = '<i class="bi bi-heart"></i>';
            }
            localStorage.setItem('likedAffirmations', JSON.stringify(likedAffirmations));
        }

        function toggleSave() {
            if (!currentAffirmation) return;
            const index = savedAffirmations.findIndex(a => a.text === currentAffirmation.text);
            if (index === -1) {
                savedAffirmations.push(currentAffirmation);
                saveBtn.classList.add('active');
                saveBtn.innerHTML = '<i class="bi bi-bookmark-fill"></i>';
            } else {
                savedAffirmations.splice(index, 1);
                saveBtn.classList.remove('active');
                saveBtn.innerHTML = '<i class="bi bi-bookmark"></i>';
            }
            localStorage.setItem('savedAffirmations', JSON.stringify(savedAffirmations));
        }

        function updateButtonStates() {
            if (!currentAffirmation) return;
            const isLiked = likedAffirmations.some(a => a.text === currentAffirmation.text);
            if (likeBtn) {
                likeBtn.classList.toggle('active', isLiked);
                likeBtn.innerHTML = isLiked
                    ? '<i class="bi bi-heart-fill"></i>'
                    : '<i class="bi bi-heart"></i>';
            }

            const isSaved = savedAffirmations.some(a => a.text === currentAffirmation.text);
            if (saveBtn) {
                saveBtn.classList.toggle('active', isSaved);
                saveBtn.innerHTML = isSaved
                    ? '<i class="bi bi-bookmark-fill"></i>'
                    : '<i class="bi bi-bookmark"></i>';
            }
        }

        function renderFavorites() {
            if (!favoritesContainer) return;
            favoritesContainer.innerHTML = '';
            if (savedAffirmations.length === 0) {
                if (emptyFavorites) {
                    favoritesContainer.appendChild(emptyFavorites);
                    emptyFavorites.classList.remove('d-none');
                }
                return;
            }
            if (emptyFavorites) emptyFavorites.classList.add('d-none');
            savedAffirmations.forEach((affirmation, index) => {
                const favoriteItem = document.createElement('div');
                favoriteItem.className = 'favorite-item';
                favoriteItem.innerHTML = `
                    <img src="${affirmation.image}" alt="Affirmation" class="favorite-image">
                    <div class="favorite-overlay">
                        <p class="favorite-quote">${affirmation.text}</p>
                    </div>
                    <button class="remove-favorite" data-index="${index}">
                        <i class="bi bi-x"></i>
                    </button>
                `;
                favoritesContainer.appendChild(favoriteItem);
            });
            document.querySelectorAll('.remove-favorite').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    savedAffirmations.splice(index, 1);
                    localStorage.setItem('savedAffirmations', JSON.stringify(savedAffirmations));
                    renderFavorites();
                    updateButtonStates();
                });
            });
        }

        // Wire up affirmation buttons
        if (refreshBtn) refreshBtn.addEventListener('click', getRandomAffirmation);
        if (prevBtn) prevBtn.addEventListener('click', getRandomAffirmation);
        if (nextBtn) nextBtn.addEventListener('click', getRandomAffirmation);
        if (prevBtnSide) prevBtnSide.addEventListener('click', getRandomAffirmation);
        if (nextBtnSide) nextBtnSide.addEventListener('click', getRandomAffirmation);
        if (likeBtn) likeBtn.addEventListener('click', toggleLike);
        if (saveBtn) saveBtn.addEventListener('click', toggleSave);
        

        // Theme toggle functionality
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            
            const icon = themeToggle.querySelector('i');
            
            if (newTheme === 'dark') {
                icon.className = 'bi bi-sun fs-5';
            } else {
                icon.className = 'bi bi-moon fs-5';
            }
            
            localStorage.setItem('theme', newTheme);
        }

        if (themeToggle) themeToggle.addEventListener('click', toggleTheme);

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            const icon = themeToggle ? themeToggle.querySelector('i') : null;
            
            if (icon) {
                if (savedTheme === 'dark') {
                    icon.className = 'bi bi-sun fs-5';
                } else {
                    icon.className = 'bi bi-moon fs-5';
                }
            }
        }

        // Sidebar toggle
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
                mobileOverlay.classList.toggle('active');
            });
        }

        // Quick actions
        if (quickActions) {
            quickActions.forEach(action => {
                action.addEventListener('click', function() {
                    const actionText = this.getAttribute('data-action');
                    const quickMessages = {
                        "I need to talk": "I need someone to talk to right now.",
                        "Tell me a story": "Could you tell me an uplifting story?",
                        "I'm feeling anxious": "I'm feeling anxious and could use some support."
                    };
                    sendMessage(quickMessages[actionText]);
                });
            });
        }

        // Send message functionality
        if (sendMessageBtn && messageInput) {
            sendMessageBtn.addEventListener('click', function() {
                if (messageInput.value.trim()) {
                    sendMessage(messageInput.value);
                    messageInput.value = '';
                }
            });

            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && messageInput.value.trim()) {
                    sendMessage(messageInput.value);
                    messageInput.value = '';
                }
            });
        }

        // Breathing exercise
        if (startBreathingBtn) {
            startBreathingBtn.addEventListener('click', function() {
                breathingActive = !breathingActive;
                
                if (breathingActive) {
                    this.innerHTML = '<i class="bi bi-pause-circle me-2"></i> Pause Exercise';
                    startBreathingExercise();
                } else {
                    this.innerHTML = '<i class="bi bi-play-circle me-2"></i> Start Exercise';
                    stopBreathingExercise();
                }
            });
        }

        function startBreathingExercise() {
            breathingPhaseState = 'inhale';
            breathingCountState = 4;
            updateBreathingUI();
            
            breathingInterval = setInterval(function() {
                breathingCountState--;
                
                if (breathingCountState <= 0) {
                    breathingPhaseState = breathingPhaseState === 'inhale' ? 'hold' : breathingPhaseState === 'hold' ? 'exhale' : 'inhale';
                    
                    if (breathingPhaseState === 'inhale') breathingCountState = 4;
                    else if (breathingPhaseState === 'hold') breathingCountState = 7;
                    else if (breathingPhaseState === 'exhale') breathingCountState = 8;
                }
                
                updateBreathingUI();
            }, 1000);
        }

        function stopBreathingExercise() {
            if (breathingInterval) {
                clearInterval(breathingInterval);
            }
            if (breathingCircle && breathCount && breathPhase) {
                breathingCircle.classList.remove('breathing-in', 'breathing-out');
                breathCount.textContent = '4';
                breathPhase.textContent = 'Inhale';
            }
        }

        function updateBreathingUI() {
            if (breathCount && breathPhase && breathingCircle) {
                breathCount.textContent = breathingCountState;
                
                if (breathingPhaseState === 'inhale') {
                    breathPhase.textContent = 'Inhale';
                    breathingCircle.classList.add('breathing-in');
                    breathingCircle.classList.remove('breathing-out');
                } else if (breathingPhaseState === 'hold') {
                    breathPhase.textContent = 'Hold';
                    breathingCircle.classList.remove('breathing-in', 'breathing-out');
                } else if (breathingPhaseState === 'exhale') {
                    breathPhase.textContent = 'Exhale';
                    breathingCircle.classList.remove('breathing-in');
                    breathingCircle.classList.add('breathing-out');
                }
            }
        }

        // Send message function
        async function sendMessage(text) {
            if (!text || !text.trim()) return;
            
            const userMessage = {
                id: Date.now(),
                text: text.trim(),
                sender: "user",
                timestamp: new Date(),
            };
            renderMessage(userMessage);
            
            renderTypingIndicator();
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage.text })
                });

                removeTypingIndicator();

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'The server returned an error.');
                }

                const data = await response.json();
                
                const botMessage = {
                    id: Date.now() + 1,
                    text: data.reply,
                    sender: "bot",
                    timestamp: new Date(),
                };
                renderMessage(botMessage);

            } catch (error) {
                console.error('Chat API Error:', error);
                removeTypingIndicator();
                
                const errorMessage = {
                    id: Date.now() + 1,
                    text: `Sorry, I couldn't connect to my brain. Please check the connection and try again. (${error.message})`,
                    sender: "bot",
                    timestamp: new Date(),
                };
                renderMessage(errorMessage);
            }
        }

        function renderMessage(message) {
            if (!messagesContainer) return;
            
            const messageEl = document.createElement('div');
            messageEl.className = `message ${message.sender} animate-fade-in`;
            
            const messageText = document.createElement('p');
            messageText.className = 'mb-1';
            messageText.textContent = message.text;
            
            const timestamp = document.createElement('small');
            timestamp.className = 'opacity-75';
            timestamp.textContent = message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageEl.appendChild(messageText);
            messageEl.appendChild(timestamp);
            
            messagesContainer.appendChild(messageEl);
            scrollToBottom();
        }

        function renderTypingIndicator() {
            if (!messagesContainer) return;
            
            const typingEl = document.createElement('div');
            typingEl.className = 'typing-indicator';
            typingEl.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot animate-bounce';
                dot.style.animationDelay = `${i * 0.2}s`;
                typingEl.appendChild(dot);
            }
            
            messagesContainer.appendChild(typingEl);
            scrollToBottom();
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
  const streakElem = document.getElementById('streakCounter');
  const container = document.getElementById('activitiesContainer');
  const btn = document.getElementById('surpriseMeBtn');
  

  // Fetch and show current streak
  function fetchStreak() {
    fetch('/activities/streak')
      .then(res => res.json())
      .then(data => {
        streakElem.textContent = data.streak ?? 0;
      });
  }

  // Load 5 random activities and display as cards
function renderActivities(activities) {
  const container = document.getElementById('activitiesContainer');
  container.innerHTML = '';

  const list = document.createElement('ul');
  list.className = 'list-group w-100';

  activities.forEach(a => {
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex align-items-center justify-content-between';

    li.innerHTML = `
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="act${a.id}">
        <label class="form-check-label ms-2" for="act${a.id}">
          <strong>${a.title}</strong><br>
          <small class="text-muted">${a.description}</small>
        </label>
      </div>
    `;

    li.querySelector('input').addEventListener('change', e => {
      if (e.target.checked) {
        li.classList.add('animate__animated', 'animate__fadeOut');
        setTimeout(() => li.remove(), 500);
      }
    });

    list.appendChild(li);
  });

  container.appendChild(list);
}

document.getElementById('surpriseMeBtn').addEventListener('click', () => {
  fetch('/activities/random?count=5')
    .then(r => r.json())
    .then(renderActivities)
    .catch(err => console.error("Error loading activities:", err));
});
        });


        function scrollToBottom() {
            if (messagesContainer) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Initialize dropdowns and load home view
        initializeDropdowns();
        showView(homeView);
    });

    document.querySelectorAll('.activity-checkbox').forEach(cb => {
  cb.addEventListener('change', function() {
    if (this.checked) {
      const card = this.closest('.activity-card');
      card.classList.add('completed');
      setTimeout(() => card.style.display = 'none', 500); // fade out
    }
  });
});


document.addEventListener('DOMContentLoaded', () => {
  const surpriseBtn = document.getElementById('surpriseMeBtn');
  const activitiesContainer = document.getElementById('activitiesContainer');

  if (surpriseBtn) {
    surpriseBtn.addEventListener('click', () => {
      fetch('/activities/random?count=5')
        .then(r => r.json())
        .then(activities => {
          activitiesContainer.innerHTML = ''; // clear old ones
          activities.forEach(a => {
            const card = document.createElement('div');
            card.className = 'col-md-6 col-lg-4';
            card.innerHTML = `
              <label class="activity-card">
                <input type="checkbox" class="activity-checkbox">
                <div class="card-body">
                  <h5 class="card-title">${a.title}</h5>
                  <p class="card-text">${a.description}</p>
                </div>
              </label>
            `;
            activitiesContainer.appendChild(card);
          });

          // re-attach checkbox animation
          activitiesContainer.querySelectorAll('.activity-checkbox').forEach(cb => {
            cb.addEventListener('change', function() {
              if (this.checked) {
                const card = this.closest('.activity-card');
                card.classList.add('completed');
                setTimeout(() => card.style.display = 'none', 500);
              }
            });
          });
        })
        .catch(err => {
          console.error("Error loading activities:", err);
        });
    });
  }
});
   

</script>


</body>
</html>