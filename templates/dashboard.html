<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MannKiBaat_2.0: Generative AI for Youth Mental Wellness</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/dashboard.css">
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Fixed Navbar -->
    <nav class="navbar fixed-top navbar-expand-lg">
        <div class="container-fluid">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="bi bi-list text-white fs-5"></i>
                <span class="app-title">MannKiBaat_2.0</span>
            </button>
            <div class="ms-auto d-flex align-items-center">
                <button class="theme-toggle me-3" id="themeToggle">
                    <i class="bi bi-sun fs-5"></i>
                </button>
                <div class="dropdown">
                    <button class="btn dropdown-toggle" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle"></i>
                        <span class="ms-2">Profile</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                        <li><a class="dropdown-item" href="#" data-view="profile">View Profile</a></li>
                        <li><a class="dropdown-item" href="#" data-view="favorites">Favorite Affirmations</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="nav-items mt-4">
            <div class="nav-item active" data-view="home">
                <i class="bi bi-house"></i>
                <span class="ms-2">Home</span>
            </div>
            <div class="nav-item" data-view="chatbot">
                <i class="bi bi-chat"></i>
                <span class="ms-2">Chat Bot</span>
            </div>
            <div class="nav-item" data-view="crisis">
                <i class="bi bi-exclamation-triangle"></i>
                <span class="ms-2">Crisis Detection</span>
            </div>
            <div class="nav-item" data-view="community">
                <i class="bi bi-people"></i>
                <span class="ms-2">Community</span>
            </div>
            <div class="nav-item" data-view="activities">
                <i class="bi bi-controller"></i>
                <span class="ms-2">Activities</span>
            </div>
            <div class="nav-item" data-view="affirmations">
                <i class="bi bi-stars"></i>
                <span class="ms-2">Affirmations</span>
            </div>
            <div class="nav-item" data-view="lifestyle">
                <i class="bi bi-heart"></i>
                <span class="ms-2">Lifestyle</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Home View -->
        <div id="homeView">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-bg-animation">
                    <div class="hero-bg-circle circle-1"></div>
                    <div class="hero-bg-circle circle-2"></div>
                </div>
                
                <div class="container position-relative z-10">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 text-center">
                            <h1 class="display-3 fw-bold mb-4 text-gradient">MannKiBaat_2.0 - AI for Mental Wellness</h1>
                            <p class="lead mb-5">A safe space for chat, community, and personal growth.</p>
                            <button class="btn btn-gradient btn-lg px-5 py-3 fw-semibold animate-pulse-glow" data-view="chatbot">
                                Start Chatting <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="py-5">
                <div class="container py-5">
                    <h2 class="text-center mb-5 display-5 fw-bold">Our Features</h2>
                    
                    <div class="row g-4">
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="chatbot">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-chat-text text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">AI Chat Bot</h3>
                                <p class="text-center">Friendly conversations, storytelling, and creative poetry to support your mental wellness journey.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="crisis">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-exclamation-triangle text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Crisis Support</h3>
                                <p class="text-center">Immediate access to crisis resources and emergency support when you need it most.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-bs-toggle="modal" data-bs-target="#communityModal">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-people text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Community Hub</h3>
                                <p class="text-center">Connect with peers, share stories, and join supportive group activities.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-bs-toggle="modal" data-bs-target="#activitiesModal">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-controller text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Wellness Activities</h3>
                                <p class="text-center">Personalized and community activities designed to boost your mental health.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-view="affirmations">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-stars text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Daily Affirmations</h3>
                                <p class="text-center">Uplifting messages delivered through text, voice, and video formats.</p>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="feature-card p-4 h-100" data-bs-toggle="modal" data-bs-target="#lifestyleModal">
                                <div class="card-icon mb-4">
                                    <i class="bi bi-heart text-white fs-3"></i>
                                </div>
                                <h3 class="h4 text-center mb-3">Lifestyle Tracking</h3>
                                <p class="text-center">Monitor your sleep, diet, and exercise with personalized wellness suggestions.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            {% include 'components/footer.html' %}
        </div>

        <!-- Chatbot View -->
        <div id="chatbotView" class="d-none">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary me-3" id="backToHome">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <div class="d-flex align-items-center">
                            <div class="card-icon me-3" style="width: 40px; height: 40px;">
                                <i class="bi bi-chat-text text-white"></i>
                            </div>
                            <div>
                                <h5 class="mb-0">MindfulChat</h5>
                                <small class="text-muted">Your AI wellness companion</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="message bot animate-fade-in">
                        <p class="mb-1">Hello! I'm MindfulChat, your AI companion. How are you feeling today?</p>
                        <small class="opacity-75">10:00 AM</small>
                    </div>
                </div>

                <div class="message-input">
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-secondary btn-sm quick-action" data-action="I need to talk">
                            <i class="bi bi-chat me-1"></i> I need to talk
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-action" data-action="Tell me a story">
                            <i class="bi bi-book me-1"></i> Tell me a story
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-action" data-action="I'm feeling anxious">
                            <i class="bi bi-heart me-1"></i> I'm feeling anxious
                        </button>
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control bg-transparent text-light border-secondary" placeholder="Type your message..." id="messageInput">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="bi bi-mic"></i>
                        </button>
                        <button class="btn btn-gradient" type="button" id="sendMessage">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crisis Detection View -->
        <div id="crisisView" class="d-none crisis-section">
            <div class="border-bottom p-4">
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-secondary me-3" id="backToHomeCrisis">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <div class="d-flex align-items-center">
                        <div class="card-icon me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-exclamation-triangle text-white"></i>
                        </div>
                        <div>
                            <h5 class="mb-0">Crisis Support</h5>
                            <small class="text-muted">Immediate help is available 24/7</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container py-5">
                <!-- Emergency Contacts Section -->
                <div class="card emergency-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-exclamation-triangle-fill me-2"></i> Emergency Resources</h2>
                        <p class="card-text mb-4">If you're in immediate danger or having thoughts of self-harm, reach out now.</p>
                        
                        <div class="row g-4">
                            <div class="col-md-4">
                                <div class="text-center p-4 rounded-lg h-100" style="background-color: rgba(220, 38, 38, 0.1);">
                                    <i class="bi bi-telephone-fill display-4 mb-3" style="color: var(--bs-red);"></i>
                                    <h3 class="h5 mb-3">988 Lifeline</h3>
                                    <p class="mb-3">Suicide & Crisis Lifeline</p>
                                    <button class="btn emergency-btn w-100" data-action="988">
                                        Call Now
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="text-center p-4 rounded-lg h-100" style="background-color: rgba(234, 88, 12, 0.1);">
                                    <i class="bi bi-chat-dots-fill display-4 mb-3" style="color: var(--bs-orange);"></i>
                                    <h3 class="h5 mb-3">Crisis Text Line</h3>
                                    <p class="mb-3">Text HOME to 741741</p>
                                    <button class="btn emergency-btn w-100" data-action="741741">
                                        Text Now
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="text-center p-4 rounded-lg h-100" style="background-color: rgba(220, 38, 38, 0.1);">
                                    <i class="bi bi-ambulance display-4 mb-3" style="color: var(--bs-red);"></i>
                                    <h3 class="h5 mb-3">Emergency Services</h3>
                                    <p class="mb-3">For immediate danger</p>
                                    <button class="btn emergency-btn w-100" data-action="911">
                                        Call 911
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Assessment Section -->
                <div class="card assessment-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-clipboard-heart me-2"></i> Risk Assessment</h2>
                        <p class="card-text mb-4">Help us understand how you're feeling right now.</p>
                        
                        <div class="mb-4">
                            <label class="form-label">Are you having thoughts of hurting yourself?</label>
                            <textarea class="form-control bg-transparent border-secondary" rows="3" placeholder="You can share as much or as little as you're comfortable with..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Do you have a plan to hurt yourself?</label>
                            <textarea class="form-control bg-transparent border-secondary" rows="3" placeholder="This helps us understand the urgency of your situation..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Who can you reach out to for support right now?</label>
                            <textarea class="form-control bg-transparent border-secondary" rows="3" placeholder="Friends, family, counselors, or other support people..."></textarea>
                        </div>
                        
                        <button class="btn btn-gradient w-100">
                            <i class="bi bi-send me-2"></i> Submit Assessment
                        </button>
                    </div>
                </div>

                <!-- Safety Planning Section -->
                <div class="card safety-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-shield-check me-2"></i> Safety Planning</h2>
                        <p class="card-text mb-4">Create your personalized safety plan for difficult moments.</p>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="bi bi-telephone me-2"></i> Support Contacts</h4>
                            <div class="support-contacts">
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Contact name and phone">
                                </div>
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Contact name and phone">
                                </div>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-plus-circle me-1"></i> Add Another Contact
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="bi bi-lightbulb me-2"></i> Coping Strategies</h4>
                            <div class="coping-strategies">
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Coping strategy">
                                </div>
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Coping strategy">
                                </div>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-plus-circle me-1"></i> Add Another Strategy
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="bi bi-geo-alt me-2"></i> Safe Environments</h4>
                            <div class="safe-environments">
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Safe place">
                                </div>
                                <div class="mb-2">
                                    <input type="text" class="form-control bg-transparent border-secondary mb-2" placeholder="Safe place">
                                </div>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-plus-circle me-1"></i> Add Another Place
                                </button>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center p-3 rounded-lg mb-3" style="background-color: rgba(0,0,0,0.05);">
                            <div>
                                <h5 class="mb-1">Enable Warning Signs Alerts</h5>
                                <p class="mb-0 small">Get reminders about your personal warning signs</p>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" checked>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center p-3 rounded-lg">
                            <div>
                                <h5 class="mb-1">Professional Help Reminders</h5>
                                <p class="mb-0 small">Regular check-ins about professional support</p>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" checked>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calming Exercises Section -->
                <div class="card calming-card border-0 shadow-lg mb-5">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-wind me-2"></i> Calming Exercises</h2>
                        <p class="card-text mb-4">Quick techniques to help you feel more grounded and calm.</p>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h4 class="mb-3"><i class="bi bi-wind me-2"></i> Breathing Exercise</h4>
                                    <div class="breathing-circle" id="breathingCircle">
                                        <div class="text-center">
                                            <div class="display-3 fw-bold" id="breathCount">4</div>
                                            <div class="text-uppercase fw-bold" id="breathPhase">Inhale</div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-4">
                                        <button class="btn btn-gradient" id="startBreathing">
                                            <i class="bi bi-play-circle me-2"></i> Start Exercise
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h4 class="mb-3"><i class="bi bi-eye me-2"></i> Grounding Technique</h4>
                                    <p>Follow the 5-4-3-2-1 method to center yourself:</p>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item bg-transparent border-secondary">5 things you can see</li>
                                        <li class="list-group-item bg-transparent border-secondary">4 things you can touch</li>
                                        <li class="list-group-item bg-transparent border-secondary">3 things you can hear</li>
                                        <li class="list-group-item bg-transparent border-secondary">2 things you can smell</li>
                                        <li class="list-group-item bg-transparent border-secondary">1 thing you can taste</li>
                                    </ul>
                                    <button class="btn btn-outline-secondary mt-3 w-100">
                                        <i class="bi bi-clock me-2"></i> Start 5-Minute Exercise
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resources Section -->
                <div class="card resources-card border-0 shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="card-title mb-4"><i class="bi bi-book me-2"></i> Additional Resources</h2>
                        <p class="card-text mb-4">Links to additional mental health support services and information.</p>
                        
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> NAMI</h5>
                                    <p class="small">National Alliance on Mental Illness - Support groups and educational resources</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> Mental Health America</h5>
                                    <p class="small">Screening tools and local resources for mental health support</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> Crisis Text Line</h5>
                                    <p class="small">24/7 text-based crisis support for any kind of crisis</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="rounded-lg p-4 h-100" style="background-color: rgba(0,0,0,0.05);">
                                    <h5><i class="bi bi-link-45deg me-2"></i> SAMHSA</h5>
                                    <p class="small">Substance Abuse and Mental Health Services Administration - Treatment locator</p>
                                    <button class="btn btn-sm btn-gradient">Visit Website</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profileView" class="d-none profile-section">
            <div class="container py-5">
                <div class="profile-card">
                    <h2>Welcome, {{ user.firstName }}!</h2>
                    <h3>Lifestyle Details:</h3>
                    {% if lifestyle %}
                    <p>Diet: {{ lifestyle.diet }}</p>
                    <p>Activity: {{ lifestyle.physicalActivity }}</p>
                    <p>Sleep Hours: {{ lifestyle.sleepHrs }}</p>
                    {% else %}
                    <p>No lifestyle data available.</p>
                    {% endif %}
                    <h3>Selected Categories:</h3>
                    <ul>
                        {% for c in categories %}
                        <li><b>{{ c.category }}:</b> {{ c.subcategory }} <br> {{ c.description }}</li>
                        {% endfor %}
                    </ul>
                    <div class="mt-4">
                        <button class="btn btn-gradient" data-view="home">Back to Home</button>
                        <a href="/logout" class="btn btn-outline-secondary ms-2">Logout</a>
                    </div>
                </div>
            </div>
        </div>

       <!-- Affirmations View -->
<div id="affirmationsView" class="d-none">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="d-flex justify-content-between align-items-center mb-5">
          <h2 class="text-gradient">Daily Affirmations</h2>
          <div>
            <button class="btn btn-outline-secondary me-2" id="prevAffirmation">
              <i class="bi bi-arrow-left"></i> Previous
            </button>
            <button class="btn btn-outline-secondary" id="nextAffirmation">
              Next <i class="bi bi-arrow-right"></i>
            </button>
          </div>
        </div>
<div class="affirmation-card">
  <div class="affirmation-image" id="affirmationImage">
    <!-- Previous button on left of image -->
    <button class="side-btn prev-btn" id="prevAffirmation" title="Previous">
      <i class="bi bi-chevron-left"></i>
    </button>
    <!-- Affirmation text overlay -->
    <div class="affirmation-overlay">
      <p class="affirmation-text" id="affirmationText"></p>
    </div>
    <!-- Like, refresh, save buttons separately -->
    <div class="affirmation-action action-left">
      <button class="btn-affirmation" id="likeAffirmation" title="Like">
        <i class="bi bi-heart"></i>
      </button>
    </div>
    <div class="affirmation-action action-center">
      <button class="btn-affirmation" id="refreshAffirmation" title="Refresh">
        <i class="bi bi-arrow-repeat"></i>
      </button>
    </div>
    <div class="affirmation-action action-right">
      <button class="btn-affirmation" id="saveAffirmation" title="Save">
        <i class="bi bi-bookmark"></i>
      </button>
    </div>
    <!-- Next button on right of image -->
    <button class="side-btn next-btn" id="nextAffirmation" title="Next">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</div>


        </div>
        <div class="mt-5">
          <h4 class="mb-4">Categories</h4>
          <div class="d-flex flex-wrap gap-2">
            <button class="btn btn-outline-primary category-btn active" data-category="all">All</button>
            <button class="btn btn-outline-primary category-btn" data-category="motivation">Motivation</button>
            <button class="btn btn-outline-primary category-btn" data-category="confidence">Confidence</button>
            <button class="btn btn-outline-primary category-btn" data-category="peace">Inner Peace</button>
            <button class="btn btn-outline-primary category-btn" data-category="gratitude">Gratitude</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


        <!-- Favorites View -->
        <div id="favoritesView" class="d-none">
            <div class="container py-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="text-gradient">Your Favorite Affirmations</h2>
                    <button class="btn btn-outline-secondary" data-view="affirmations">
                        <i class="bi bi-arrow-left"></i> Back to Affirmations
                    </button>
                </div>

                <div id="favoritesContainer" class="favorites-grid">
                    <div class="text-center py-5" id="emptyFavorites">
                        <i class="bi bi-bookmark-plus display-1 text-muted"></i>
                        <p class="mt-3">You haven't saved any affirmations yet.</p>
                        <button class="btn btn-gradient mt-2" data-view="affirmations">
                            Browse Affirmations
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="communityModal" tabindex="-1" aria-labelledby="communityModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="communityModalLabel">Community Hub</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Join our supportive community to connect with peers and share your experiences.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="activitiesModal" tabindex="-1" aria-labelledby="activitiesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="activitiesModalLabel">Wellness Activities</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Explore activities designed to boost your mental health and well-being.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="lifestyleModal" tabindex="-1" aria-labelledby="lifestyleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="lifestyleModalLabel">Lifestyle Tracking</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Track your sleep, diet, and exercise to improve your overall wellness.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const homeView = document.getElementById('homeView');
            const chatbotView = document.getElementById('chatbotView');
            const crisisView = document.getElementById('crisisView');
            const profileView = document.getElementById('profileView');
            const affirmationsView = document.getElementById('affirmationsView');
            const favoritesView = document.getElementById('favoritesView');
            const backToHome = document.getElementById('backToHome');
            const backToHomeCrisis = document.getElementById('backToHomeCrisis');
            const messageInput = document.getElementById('messageInput');
            const sendMessageBtn = document.getElementById('sendMessage');
            const messagesContainer = document.getElementById('messagesContainer');
            const navItems = document.querySelectorAll('.nav-item');
            const quickActions = document.querySelectorAll('.quick-action');
            const featureCards = document.querySelectorAll('.feature-card');
            const startBreathingBtn = document.getElementById('startBreathing');
            const breathingCircle = document.getElementById('breathingCircle');
            const breathCount = document.getElementById('breathCount');
            const breathPhase = document.getElementById('breathPhase');
            const themeToggle = document.getElementById('themeToggle');
            const affirmationImage = document.getElementById('affirmationImage');
            const affirmationText = document.getElementById('affirmationText');
            const likeBtn = document.getElementById('likeAffirmation');
            const refreshBtn = document.getElementById('refreshAffirmation');
            const saveBtn = document.getElementById('saveAffirmation');
            const prevBtn = document.getElementById('prevAffirmation');
            const nextBtn = document.getElementById('nextAffirmation');
            const categoryBtns = document.querySelectorAll('.category-btn');
            const favoritesContainer = document.getElementById('favoritesContainer');
            const emptyFavorites = document.getElementById('emptyFavorites');

            // State
            let currentView = 'home';
            let messages = [
                {
                    id: 1,
                    text: "Hello! I'm MindfulChat, your AI companion. How are you feeling today?",
                    sender: "bot",
                    timestamp: new Date(),
                }
            ];
            let isTyping = false;
            let breathingActive = false;
            let breathingPhaseState = 'inhale';
            let breathingCountState = 4;
            let breathingInterval = null;
            let currentAffirmationIndex = 0;
            let likedAffirmations = JSON.parse(localStorage.getItem('likedAffirmations')) || [];
            let savedAffirmations = JSON.parse(localStorage.getItem('savedAffirmations')) || [];
            let currentCategory = 'all';

            // Affirmations data
            const affirmations = [
                {
                    text: "I am capable of achieving great things.",
                    image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "motivation"
                },
                {
                    text: "I believe in myself and my abilities.",
                    image: "https://images.unsplash.com/photo-1464822759849-e0e100921dae?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "confidence"
                },
                {
                    text: "I am at peace with myself and the world around me.",
                    image: "https://images.unsplash.com/photo-1418065460487-3e41a6c84dc5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "peace"
                },
                {
                    text: "I am grateful for all the blessings in my life.",
                    image: "https://images.unsplash.com/photo-1506260405121-e77d8e5e6c0f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "gratitude"
                },
                {
                    text: "Every day is a new opportunity to grow and learn.",
                    image: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "motivation"
                },
                {
                    text: "I radiate confidence and positivity.",
                    image: "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "confidence"
                },
                {
                    text: "I choose to let go of things I cannot control.",
                    image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "peace"
                },
                {
                    text: "I appreciate the small joys in everyday life.",
                    image: "https://images.unsplash.com/photo-1502082553048-f009c37129b9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1350&q=80",
                    category: "gratitude"
                }
            ];

            // Initialize
            displayAffirmation(currentAffirmationIndex);
            updateButtonStates();
            renderFavorites();

            // Theme toggle functionality
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                
                const icon = themeToggle.querySelector('i');
                
                if (newTheme === 'dark') {
                    icon.className = 'bi bi-sun fs-5';
                } else {
                    icon.className = 'bi bi-moon fs-5';
                }
                
                localStorage.setItem('theme', newTheme);
            }

            themeToggle.addEventListener('click', toggleTheme);

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                const icon = themeToggle.querySelector('i');
                
                if (savedTheme === 'dark') {
                    icon.className = 'bi bi-sun fs-5';
                } else {
                    icon.className = 'bi bi-moon fs-5';
                }
            }

            // Sidebar toggle functionality
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
                mobileOverlay.classList.toggle('active');
            });

            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    const view = this.getAttribute('data-view');
                    if (view) {
                        setCurrentView(view);
                        navItems.forEach(nav => nav.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });

            // Feature cards navigation
            featureCards.forEach(card => {
                card.addEventListener('click', function() {
                    const view = this.getAttribute('data-view');
                    if (view) {
                        setCurrentView(view);
                        navItems.forEach(nav => {
                            nav.classList.remove('active');
                            if (nav.getAttribute('data-view') === view) {
                                nav.classList.add('active');
                            }
                        });
                    }
                });
            });

            // Profile dropdown navigation
            document.querySelectorAll('.dropdown-item[data-view]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const view = this.getAttribute('data-view');
                    setCurrentView(view);
                    navItems.forEach(nav => nav.classList.remove('active'));
                    document.querySelector('.nav-item[data-view="home"]').classList.add('active');
                });
            });

            // Back to home buttons
            if (backToHome) {
                backToHome.addEventListener('click', function() {
                    setCurrentView('home');
                    navItems.forEach(nav => {
                        nav.classList.remove('active');
                        if (nav.getAttribute('data-view') === 'home') {
                            nav.classList.add('active');
                        }
                    });
                });
            }

            if (backToHomeCrisis) {
                backToHomeCrisis.addEventListener('click', function() {
                    setCurrentView('home');
                    navItems.forEach(nav => {
                        nav.classList.remove('active');
                        if (nav.getAttribute('data-view') === 'home') {
                            nav.classList.add('active');
                        }
                    });
                });
            }

            document.querySelectorAll('[data-view="home"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    setCurrentView('home');
                    navItems.forEach(nav => {
                        nav.classList.remove('active');
                        if (nav.getAttribute('data-view') === 'home') {
                            nav.classList.add('active');
                        }
                    });
                });
            });

            // Affirmations event listeners
            if (likeBtn) likeBtn.addEventListener('click', toggleLike);
            if (refreshBtn) refreshBtn.addEventListener('click', getRandomAffirmation);
            if (saveBtn) saveBtn.addEventListener('click', toggleSave);
            if (prevBtn) prevBtn.addEventListener('click', showPreviousAffirmation);
            if (nextBtn) nextBtn.addEventListener('click', showNextAffirmation);

            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    getRandomAffirmation();
                });
            });

            // Quick actions
            if (quickActions) {
                quickActions.forEach(action => {
                    action.addEventListener('click', function() {
                        const actionText = this.getAttribute('data-action');
                        const quickMessages = {
                            "I need to talk": "I need someone to talk to right now.",
                            "Tell me a story": "Could you tell me an uplifting story?",
                            "I'm feeling anxious": "I'm feeling anxious and could use some support."
                        };
                        sendMessage(quickMessages[actionText]);
                    });
                });
            }

            // Send message
            if (sendMessageBtn && messageInput) {
                sendMessageBtn.addEventListener('click', function() {
                    if (messageInput.value.trim()) {
                        sendMessage(messageInput.value);
                        messageInput.value = '';
                    }
                });

                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && messageInput.value.trim()) {
                        sendMessage(messageInput.value);
                        messageInput.value = '';
                    }
                });
            }

            // Breathing exercise
            if (startBreathingBtn) {
                startBreathingBtn.addEventListener('click', function() {
                    breathingActive = !breathingActive;
                    
                    if (breathingActive) {
                        this.innerHTML = '<i class="bi bi-pause-circle me-2"></i> Pause Exercise';
                        startBreathingExercise();
                    } else {
                        this.innerHTML = '<i class="bi bi-play-circle me-2"></i> Start Exercise';
                        stopBreathingExercise();
                    }
                });
            }

            function startBreathingExercise() {
                breathingPhaseState = 'inhale';
                breathingCountState = 4;
                updateBreathingUI();
                
                breathingInterval = setInterval(function() {
                    breathingCountState--;
                    
                    if (breathingCountState <= 0) {
                        breathingPhaseState = breathingPhaseState === 'inhale' ? 'hold' : breathingPhaseState === 'hold' ? 'exhale' : 'inhale';
                        
                        if (breathingPhaseState === 'inhale') breathingCountState = 4;
                        else if (breathingPhaseState === 'hold') breathingCountState = 7;
                        else if (breathingPhaseState === 'exhale') breathingCountState = 8;
                    }
                    
                    updateBreathingUI();
                }, 1000);
            }

            function stopBreathingExercise() {
                if (breathingInterval) {
                    clearInterval(breathingInterval);
                }
                if (breathingCircle && breathCount && breathPhase) {
                    breathingCircle.classList.remove('breathing-in', 'breathing-out');
                    breathCount.textContent = '4';
                    breathPhase.textContent = 'Inhale';
                }
            }

            function updateBreathingUI() {
                if (breathCount && breathPhase && breathingCircle) {
                    breathCount.textContent = breathingCountState;
                    
                    if (breathingPhaseState === 'inhale') {
                        breathPhase.textContent = 'Inhale';
                        breathingCircle.classList.add('breathing-in');
                        breathingCircle.classList.remove('breathing-out');
                    } else if (breathingPhaseState === 'hold') {
                        breathPhase.textContent = 'Hold';
                        breathingCircle.classList.remove('breathing-in', 'breathing-out');
                    } else if (breathingPhaseState === 'exhale') {
                        breathPhase.textContent = 'Exhale';
                        breathingCircle.classList.remove('breathing-in');
                        breathingCircle.classList.add('breathing-out');
                    }
                }
            }

            // Send message function (NEW - Connected to the backend)
        async function sendMessage(text) {
            if (!text || !text.trim()) return;
            
            // 1. Create and render the user's message immediately for a responsive feel
            const userMessage = {
                id: Date.now(), // Use a unique timestamp for the ID
                text: text.trim(),
                sender: "user",
                timestamp: new Date(),
            };
            // No longer need to push to a local 'messages' array
            renderMessage(userMessage);
            
            // 2. Show the "bot is typing" indicator
            renderTypingIndicator();
            
            // 3. Send the message to your Flask backend
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage.text })
                });

                // Once we get a response, remove the typing indicator
                removeTypingIndicator();

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'The server returned an error.');
                }

                const data = await response.json();
                
                // 4. Create and render the bot's actual response
                const botMessage = {
                    id: Date.now() + 1,
                    text: data.reply,
                    sender: "bot",
                    timestamp: new Date(),
                };
                renderMessage(botMessage);

            } catch (error) {
                console.error('Chat API Error:', error);
                removeTypingIndicator(); // Make sure to remove indicator on error too
                
                // Display a helpful error message in the chat window
                const errorMessage = {
                    id: Date.now() + 1,
                    text: `Sorry, I couldn't connect to my brain. Please check the connection and try again. (${error.message})`,
                    sender: "bot",
                    timestamp: new Date(),
                };
                renderMessage(errorMessage);
            }
        }

            // Render message
            function renderMessage(message) {
                if (!messagesContainer) return;
                
                const messageEl = document.createElement('div');
                messageEl.className = `message ${message.sender} animate-fade-in`;
                
                const messageText = document.createElement('p');
                messageText.className = 'mb-1';
                messageText.textContent = message.text;
                
                const timestamp = document.createElement('small');
                timestamp.className = 'opacity-75';
                timestamp.textContent = message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageEl.appendChild(messageText);
                messageEl.appendChild(timestamp);
                
                messagesContainer.appendChild(messageEl);
                scrollToBottom();
            }

            // Render typing indicator
            function renderTypingIndicator() {
                if (!messagesContainer) return;
                
                const typingEl = document.createElement('div');
                typingEl.className = 'typing-indicator';
                typingEl.id = 'typingIndicator';
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'typing-dot animate-bounce';
                    dot.style.animationDelay = `${i * 0.2}s`;
                    typingEl.appendChild(dot);
                }
                
                messagesContainer.appendChild(typingEl);
                scrollToBottom();
            }

            // Remove typing indicator
            function removeTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            // Scroll to bottom of messages
            function scrollToBottom() {
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }

            // Set current view
            function setCurrentView(view) {
                currentView = view;
                
                document.querySelectorAll('[id$="View"]').forEach(view => {
                    view.classList.add('d-none');
                });
                
                const targetView = document.getElementById(view + 'View');
                if (targetView) {
                    targetView.classList.remove('d-none');
                }
                
                window.scrollTo(0, 0);
                
                if (view === 'chatbot') {
                    setTimeout(() => {
                        scrollToBottom();
                    }, 100);
                } else if (view === 'favorites') {
                    renderFavorites();
                }
            }

            // Affirmations functions
            function displayAffirmation(index) {
                const affirmation = affirmations[index];
                affirmationImage.style.backgroundImage = `url(${affirmation.image})`;
                affirmationText.textContent = affirmation.text;
                currentAffirmationIndex = index;
                updateButtonStates();
            }

            function getRandomAffirmation() {
                let filteredAffirmations = affirmations;
                if (currentCategory !== 'all') {
                    filteredAffirmations = affirmations.filter(a => a.category === currentCategory);
                }
                
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * filteredAffirmations.length);
                } while (filteredAffirmations.length > 1 && randomIndex === currentAffirmationIndex);
                
                currentAffirmationIndex = affirmations.indexOf(filteredAffirmations[randomIndex]);
                displayAffirmation(currentAffirmationIndex);
            }

            function showPreviousAffirmation() {
                let newIndex = currentAffirmationIndex - 1;
                if (newIndex < 0) newIndex = affirmations.length - 1;
                displayAffirmation(newIndex);
            }

            function showNextAffirmation() {
                let newIndex = currentAffirmationIndex + 1;
                if (newIndex >= affirmations.length) newIndex = 0;
                displayAffirmation(newIndex);
            }

            function toggleLike() {
                const currentAffirmation = affirmations[currentAffirmationIndex];
                const index = likedAffirmations.findIndex(a => a.text === currentAffirmation.text);
                
                if (index === -1) {
                    likedAffirmations.push(currentAffirmation);
                    likeBtn.classList.add('active');
                    likeBtn.innerHTML = '<i class="bi bi-heart-fill"></i> Liked';
                } else {
                    likedAffirmations.splice(index, 1);
                    likeBtn.classList.remove('active');
                    likeBtn.innerHTML = '<i class="bi bi-heart"></i> Like';
                }
                
                localStorage.setItem('likedAffirmations', JSON.stringify(likedAffirmations));
            }

            function toggleSave() {
                const currentAffirmation = affirmations[currentAffirmationIndex];
                const index = savedAffirmations.findIndex(a => a.text === currentAffirmation.text);
                
                if (index === -1) {
                    savedAffirmations.push(currentAffirmation);
                    saveBtn.classList.add('active');
                    saveBtn.innerHTML = '<i class="bi bi-bookmark-fill"></i> Saved';
                    // TODO: Add POST request to /save_affirmation
                } else {
                    savedAffirmations.splice(index, 1);
                    saveBtn.classList.remove('active');
                    saveBtn.innerHTML = '<i class="bi bi-bookmark"></i> Save';
                }
                
                localStorage.setItem('savedAffirmations', JSON.stringify(savedAffirmations));
            }

            function updateButtonStates() {
                const currentAffirmation = affirmations[currentAffirmationIndex];
                
                // Update like button
                const isLiked = likedAffirmations.some(a => a.text === currentAffirmation.text);
                if (isLiked) {
                    likeBtn.classList.add('active');
                    likeBtn.innerHTML = '<i class="bi bi-heart-fill"></i> Liked';
                } else {
                    likeBtn.classList.remove('active');
                    likeBtn.innerHTML = '<i class="bi bi-heart"></i> Like';
                }
                
                // Update save button
                const isSaved = savedAffirmations.some(a => a.text === currentAffirmation.text);
                if (isSaved) {
                    saveBtn.classList.add('active');
                    saveBtn.innerHTML = '<i class="bi bi-bookmark-fill"></i> Saved';
                } else {
                    saveBtn.classList.remove('active');
                    saveBtn.innerHTML = '<i class="bi bi-bookmark"></i> Save';
                }
            }

            function renderFavorites() {
                favoritesContainer.innerHTML = '';
                
                if (savedAffirmations.length === 0) {
                    favoritesContainer.appendChild(emptyFavorites);
                    emptyFavorites.classList.remove('d-none');
                    return;
                }
                
                emptyFavorites.classList.add('d-none');
                
                savedAffirmations.forEach((affirmation, index) => {
                    const favoriteItem = document.createElement('div');
                    favoriteItem.className = 'favorite-item';
                    favoriteItem.innerHTML = `
                        <img src="${affirmation.image}" alt="Affirmation" class="favorite-image">
                        <div class="favorite-overlay">
                            <p class="favorite-quote">${affirmation.text}</p>
                        </div>
                        <button class="remove-favorite" data-index="${index}">
                            <i class="bi bi-x"></i>
                        </button>
                    `;
                    favoritesContainer.appendChild(favoriteItem);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-favorite').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        savedAffirmations.splice(index, 1);
                        localStorage.setItem('savedAffirmations', JSON.stringify(savedAffirmations));
                        renderFavorites();
                        updateButtonStates();
                    });
                });
            }

            // Add animation to feature cards
            if (featureCards) {
                featureCards.forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                    card.classList.add('animate-fade-in');
                });
            }
        });
    </script>
</body>
</html>