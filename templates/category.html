<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Select Categories</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/category.css">
</head>

<body data-theme="light">
    <!-- Theme Toggle Button -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </div>

    <!-- Background Animation -->
    <div class="hero-bg-animation">
        <div class="hero-bg-circle circle-1"></div>
        <div class="hero-bg-circle circle-2"></div>
    </div>

    <!-- Macro Definition -->
    {% macro categoryCard(title, description, image, modal_id, modal_title, categories, class_name) %}
    <div class="col">
        <div class="card {{ class_name }} h-100 shadow-sm feature-card animate-fade-in" data-bs-toggle="modal" data-bs-target="#{{ modal_id }}" style="cursor:pointer;">
            <img src="{{ image }}" class="card-img-top" alt="{{ title }}" style="height: 180px; object-fit: cover;">
            <div class="card-body">
                <h5 class="card-title">{{ title }}</h5>
                <p class="card-text">{{ description }}</p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="{{ modal_id }}" tabindex="-1" aria-labelledby="{{ modal_id }}Label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="POST" action="/category">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="{{ modal_id }}Label">{{ modal_title }}</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <!-- Hidden input to send category name -->
                        <input type="hidden" name="category" value="{{ title }}">

                        <!-- Subcategory Selection -->
                        <div class="mb-3">
                            <label for="{{ modal_id }}_problem" class="form-label">Choose the problem you are facing</label>
                            <select class="form-select" id="{{ modal_id }}_problem" name="subcategory" required>
                                <option value="">(Select the problem)</option>
                                {% for problem in categories[title] %}
                                    <option value="{{ problem }}">{{ problem }}</option>
                                {% endfor %}
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <!-- Problem Description -->
                        <div class="mb-3">
                            <label for="{{ modal_id }}_message" class="col-form-label">Describe your problem:</label>
                            <textarea class="form-control" id="{{ modal_id }}_message" name="description"
                                placeholder="Write about your issue..." rows="3"></textarea>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-gradient">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endmacro %}

    <div class="main-content">
        <div class="container mx-auto mt-2 pt-5">
            <h1 class="text-center mb-4">Choose From Following 8 Categories!</h1>
            <hr class="w-50 mx-auto">

            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                {% set category_data = [
                    {
                        'title': 'Spirituality',
                        'description': 'Find peace, clarity, and purpose in life.',
                        'image': 'static/images/spirituality.png',
                        'modal_id': 'modal1',
                        'modal_title': 'Spiritual Growth',
                        'class_name': 'spirituality'
                    },
                    {
                        'title': 'Mindset',
                        'description': 'Overcome negative thoughts and build resilience.',
                        'image': 'static/images/mindset.png',
                        'modal_id': 'modal2',
                        'modal_title': 'Mindset Challenges',
                        'class_name': 'mindset'
                    },
                    {
                        'title': 'Health',
                        'description': 'Manage stress, sleep, and lifestyle habits.',
                        'image': 'static/images/health.png',
                        'modal_id': 'modal3',
                        'modal_title': 'Health Concerns',
                        'class_name': 'health'
                    },
                    {
                        'title': 'Personality',
                        'description': 'Boost confidence, communication, and self-image.',
                        'image': 'static/images/personality.png',
                        'modal_id': 'modal4',
                        'modal_title': 'Personality Development',
                        'class_name': 'personality'
                    },
                    {
                        'title': 'Relationships',
                        'description': 'Handle breakups, rejections, and social struggles.',
                        'image': 'static/images/relationship.png',
                        'modal_id': 'modal5',
                        'modal_title': 'Relationship Issues',
                        'class_name': 'relationships'
                    },
                    {
                        'title': 'Network',
                        'description': 'Navigate friendships, peers, and social circles.',
                        'image': 'static/images/network.png',
                        'modal_id': 'modal6',
                        'modal_title': 'Social & Peer Support',
                        'class_name': 'network'
                    },
                    {
                        'title': 'Career',
                        'description': 'Get clarity on studies, jobs, and future goals.',
                        'image': 'static/images/career.png',
                        'modal_id': 'modal7',
                        'modal_title': 'Career Stress',
                        'class_name': 'career'
                    },
                    {
                        'title': 'Money',
                        'description': 'Learn to manage expenses and reduce money stress.',
                        'image': 'static/images/money.png',
                        'modal_id': 'modal8',
                        'modal_title': 'Financial Concerns',
                        'class_name': 'money'
                    }
                ] %}
                {% for data in category_data %}
                    {{ categoryCard(
                        title=data.title,
                        description=data.description,
                        image=data.image,
                        modal_id=data.modal_id,
                        modal_title=data.modal_title,
                        categories=categories,
                        class_name=data.class_name
                    ) }}
                {% endfor %}
            </div>
        </div>
    </div>

    {% include 'components/footer.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <script>
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle i');
            if (body.getAttribute('data-theme') === 'light') {
                body.setAttribute('data-theme', 'dark');
                themeToggle.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            } else {
                body.setAttribute('data-theme', 'light');
                themeToggle.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            const themeToggle = document.querySelector('.theme-toggle i');
            if (savedTheme === 'dark') {
                themeToggle.className = 'fas fa-sun';
            } else {
                themeToggle.className = 'fas fa-moon';
            }
        });

        function showMail(id, text) {
            document.getElementById(id).innerHTML = `<p style="white-space: nowrap; margin: 0; font-weight: normal;">${text}</p>`;
        }

        function hideMail(id) {
            document.getElementById(id).innerHTML = "";
        }

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>